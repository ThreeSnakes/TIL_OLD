# Real MySQL

## 날짜: 2020.02.03 ~

## Part 15. 데이터 타입

### 목차

- [데이터 타입 설정시 주의해야 할 점](#데이터-타입-설정시-주의해야-할-점)
- [문자열](#문자열)
  - [저장공간](#저장공간)
  - [비교방식](#비교방식)
  - [문자집합(캐릭터-셋)](#문자집합캐릭터-셋)

#### 데이터 타입 설정시 주의해야 할 점

- 컬럼 데이터 타입과 길이 선정시 주의 해야 할점.
  - 저장되는 값의 성격에 맞는 최적의 타입을 설정해야 한다.
  - 가변 길이 컬럼은 최적의 길이를 지정해야 한다.
  - 조인 조건으로 사용되는 컬럼은 똑같은 데이터 타입을 선정해야 한다.

- 컬럼 데이터 선정을 고려 하지 않을 경우.
  - 컬럼 길이가 크게 선정 될 경우 디스크의 공간, 메모리, CPU 자원이 낭비 된다.
  - 컬럼 길이가 잘못 선정되거나 부족하면 서비스 도중 스키마 변경이 필요해 질 수 있다.
  - **결국 저장되는 값의 성격을 정확히 분석하고 최적의 타입과 길이를 선정하는 것이 중요하다.**

#### 문자열

##### 저장공간

- 문자열은 CHAR과 VARCHAR이 2가지 타입이 존재한다.
- 가장 큰 차이는 고정 길이인지 가변 길이인지의 여부이다.
  - CHAR 타입은 저장 공간의 크기가 고정적이지만 VARCHAR의 고정적이지 않다. VARCHAR의 경우 선언한 길이보다 작은 값이 저장되면 사용하는 공간은 작아지지만 저장된 값의 유효한 크기를 저장하기 위해서 별도로 1 ~ 1 바이트의 저장 공간이 추가로 필요하다.
- 두 문자열 타입 모두 한 글자를 저장할 떄 사용하는 문자집합에 따라 실제 저장 공간은 1 ~ 3 바이트까지 사용하게 된다.
- CHAR 타입에 저장될 떄는 추가적인 공간이 필요 없지만 VARCHAR의 경우 문자열의 길이를 관리하기 위한 1 ~ 2 바이트의 공간을 추가적으로 더 사용한다.
  - VARCHAR 타입의 길이가 255바이트 이하이면 1바이트만 사용하고 255바이트 이상으로 설정되면 2바이트를 길이를 저장하는데 사용한다. VARCHAR 타입의 최대 길이는 2바이트로 표현할 수 있는 이상은 사용할 수 없다.
  - 즉 VARCHAR 타입의 최대 길이는 65,536 이상으로 설정할 수 없다.
- 그러면 어느떄 CHAR를 사용하고 VARCHAR를 사용하느게 좋을까? 이 타입의 결정 판간 기준은 다음 2가지를 고려하자.
  - 저장되는 문자열의 길이가 대개 비슷한가?
  - 컬럼의 값이 자주 변경되는가?
- 결국 컬럼의 사용되는 값이 판단의 기준이 되는데 이는 고정길이에 따른 차이점 때문이다.
  - CHAR에서 DB에 값이 저장되고 이후에 더 긴 값으로 변경 되더라도 해당 데이터는 고정길이로 저장 되기때문에 변경되는 값의 컬럼만 업데이트를 해주면 된다.
  - VARCHAR의 경우 처음 저장된 값보다 더 긴값으로 저장되면 기존에 저장된 공간에는 길이가 초과되어 저장할 수가 없다. 결국 해당 레코드를 다른 공간으로 옮기거나 컬럼 값의 나머지 부분을 다른 공간에 저장해야 한다.
- CHAR나 VARCHAR 뒤에 지정하는 숫자는 그 칼럼의 바이트 크기가 아니라 문자의 수를 의미한다. 즉 CHAR(10) 또는 VARCHAR(10)으로 칼럼을 정의하면, 이 칼럼은 10바이트를 저장할 수 있는 공간이 아닌 10글자(문자)를 저장할 수 있는 공간을 의미한다. 그래서 칼럼이 실제적으로 사용하는 공간은 각각 달라진다.
  - 일반적으로 영어를 포함한 서구권 언어는 각 문자가 1바이트를 사용하므로 10바이트를 사용한다.
  - 한국어나 일본어와 같은 아시아권 언어는 각 문자가 최대 2바이트를 사용하므로 20바이트를 사용한다.
  - UTF-8과 같은 유니코드는 최대 3바이트까지 사용하므로 30바이트까지 사용할 수 있다.

##### 비교방식

- 기본적으로 CHAR 타입이나 VARCHAR 타입을 비교할 때 컬럼 값의 뒤쪽에 붙은 공백문자는 모두 제거하고 비교를 수행한다.
- 단 `LIKE`를 사용한 문자열 패턴 비교에서는 공백 문자가 유효 문자로 취급된다.

    ``` sql
    SELECT 'ABC       ' LIKE 'ABC' AS is_same_pattern; ## 0 FALSE
    SELECT '       ABC' LIKE 'ABC' AS is_same_pattern; ## 0 FALSE
    SELECT 'ABC       ' LIKE 'ABC%' AS is_same_pattern; ## 1 TRUE
    ```

- 결국 `LIKE`로 검색을 할 경우에는 `와일드카드(%)` 문자를 사용해야 한다.

##### 문자집합(캐릭터 셋)

- MySQL 서버와 DB, 그리고 테이블 단위로 기본 문자집합을 설정할 수 있게끔 기능을 제공한다. 테이블의 문자집합을 UTF-8로 설정하면 칼럼의 문자집합은 별도로 지정하지 않아도 해당
  테이블에 속한 컬럼은 UTF-8 문자집합을 사용한다.
- `SHOW CHARACTER SET` 명령어로 사용 가능한 문자집합을 볼 수 있다.
- 일반적으로 UTF8은 다국어 문자를 포함할 수 있는 칼럼에 사용하기에 적합하다. 디스크에 저장될 때는 1 ~ 3바이트를 사용하지만 메모리에 기록(MEMORY 테이블이나 정렬 버퍼등과 같은
  용도에서)될 떄는 무조건 3바이트 공간이 할당된다.
