# 테스트 커버리지 100%

테스트 커버리지 100%를 강력히 요구해야 한다 (클린 코더, 로버트 마틴저)

높은 테스트 커버리지의 이점
1. 모든 코스트가 테스트되었다는 사실에서 오는 자신감
2. 거침없는 리팩토링 
	- 리팩토링에 문제가 있다면 테스트가 알려준다.
3. 불필요한 프로덕션 코드가 사라진다. 
	- 남아 있다면 그것 또한 테스트를 해야 되기 때문에.
4. 프로덕션 코드에 대한 이해도 상승.
	- 이해가 충분하지 못하면 테스트를 작성할 수 없다.
5. 점점 쉬워지는 테스트 작성
	- 프로턱션 코드가 테스트를 작성하기 쉽도록 변해간다.
	- 이미 작성한 테스트를 참고해 새로운 테스트를 작성할 수 있게 된다.

테스트 커버리지를 높이기 위해 필요한 것들
- 믿음
	- 어떤 코드든 테스트를 할 수 있다는 믿음. 이러한 믿음이 없다면 테스트를 작성을 포기하게 된다.
- 시간
	- 작성할 시간이 없다면 이는 무용지물이다.

테스트 커버리지를 높이기 위해 필요하지 않는 것
- 의지
	- 의지가 없어도 최소 커버리지 설정을 해버리면 테스트는 꼭 필수로 작성해야 한다.

테스트 커버리지를 높아지면서 생기는 문제
- 느려지는 테스트
	- 테스트가 많아 질수록 테스트에 소요되는 시간이 늘어난다.
	- 이는 생산성의 저하로 발전된다.
	- 스프링 애플리케이션 컨텍스트 로딩 제거
		- 이 부분은 조금 학습이 필요함. 스프링에 대해서 아는게 없다.
		![개선 목록](attach/스크린샷%202021-04-28%20오후%207.21.47.png)
	- 느린 테스트를 개선할 수 있는 방법을 찾아봐야 한다.
		- jest도 병렬로 실행할 수 있을까..?
	- 돈으로 해결할 수 있는거는 돈으로 해결하자.
- 테스트 하기 어려운 케이스
	- ![테스테가 어려운 테스트](attach/스크린샷%202021-04-28%20오후%207.24.14.png)
	- elvis operator
		- TS에도 비슷한 경우가 있다. 이를 어떻게 체크해야 할지 고민 해봐야 한다.
		- 다만 Test Coverage tool에서 제외할수 있으면 제외하자. 시간 낭비하지말자.
- 99%는 복잡하다.
	![99%)](attach/스크린샷%202021-04-28%20오후%207.27.56.png)

테스트 커버리지가 높아도 버그는 있다.
- 테스트를 잘못 작성하는 경우
	- 충분한 테스트 코드를 작성해야 한다.
		- Mutation Testing
			- 프로덕션 코드를 무작위로 조작한뒤 테스트를 해보는것
			- 이 경우에는 테스트를 통과하면 테스트 케이스가 부족한 것이다.
			- 굉장히 느리므로, 중요한 로직에만 부분적으로 적용하는 것이 좋다.
			- Pitest
- 요구 사항에 오해가 생긴 경우
	- 요구 사항을 작성하는 사람이 테스트를 직접 작성하는 것이다.
	- 테스트가 스펙문서로 작성된것인지 확인하는 방법
		![테스트 스펙문서](attach/스크린샷%202021-04-28%20오후%207.32.58.png)하는 경우
		- 테스트가 실행될때마다 테스트의 이름으로 스펙문서를 생성하게 만들었다.
	- 다만 지속하지는 못함. 제대로 하기 위해서는 많은 시간을 소요 해야 한다.
- 컴포넌트간 협업이 실패
	- Consumer Driven Contracts
		- API를 사용하는 쪽(Consumer)가 요구사항을 machine-readable하게 기술하면 API를 제공하는 쪽(Provider)가 그 요구사항을 만족하는지 테스트 하는 것이다.
		- 이런걸 어떻게 하지..?
			- 찾아보니 JS에도 있다. [pact-js](https://github.com/pact-foundation/pact-js)
		![종류](attach/스크린샷%202021-04-28%20오후%207.35.18.png)

정리
- 테스트 커버리지 100%가 불가능한것은 아니다
- 도구와 돈의 도움을 받자