# 2021_04_12

## 1.  `Cache-Control max-age` HTTP 응답 헤더는 무엇인가? 최적화 방법은? max-age 이외의 `Cache-control` 헤더 값들엔 어떤 것들이 있고 언제 사용하면 좋을까?

Cache-Control

- `Cache-Control: no-store`
	- 캐시하지 않음. Client 요청 혹은 서버 응답에 관해서 어떤것도 저장 하지 않는다.
	- 캐시를 저장하지 않을 경우에 설정한다.
- `Cache-Control: no-cache`
	- 캐시를 하지만 재검증을 한다. 캐시된 복사본을 사용자에게 릴리즈 하기 전에, 유효성을 확인한다.
	- 캐시를 사용하지 않는다는게 아니라 검증하고 쓴다는 의미이다.
	- 요청할때마다 ETag를 검사하게 된다. = (max-age = 0과 같다.)
	- 매번 검증을 해야 할때 사용하면 좋다.
- `Cache-Control: private`
	- 단일 사용자만을 위한 캐시. 공유 캐시에 의해 저장되어서는 안된다. 
- `Cache-Control: pubilc`
	- 어떤 응답이든 캐시되어도 좋다는 것이다. 
	- 중간 매개체가 캐시해도 좋을 경우.
- `Cache-Control: max-age=<second>`
	- 해당 초만큼 캐싱을 한다. 요청시간에 상대적이며, Expires가 설정되어 있어도 max-age값이 설정되어 있으면 Expries는 무시된다.
		- 다만 HTTP 1.0 사용자를 위해 둘다 설정하는게 좋다.
	- 해당 초 만큼 캐시가 유지되는데 304 응답을 받을 경우에만 캐시되어 있는 데이터를 이용한다.
	- `s-maxage`
		- 해당 설정을 사용하면 CDN처럼 공유 캐시에 대해서 다른 TTL을 설정할 수 있게 된다. 
	- static한 리소스는 max-age를 길게해서 설정하자. 그래야 서버로의 요청이 줄어들고, 캐시를 사용해서 서버 자원과 네트워킹 타임을 아낄 수 있다.

위 설정들은 ,로 혼합해서 사용해도 된다. 

- 위 설정들은 `,`로 혼합해서 사용해도 된다.
	- `Cache-Control: private, max-age=36000`

- 완벽한 캐싱 방지를 위해서는 아래처럼 설정해야 한다.
	- `Cache-Control: no-cache, no-store, must-revalidate`
	- `must-revalidate`는 `no-caches` 정책을 프록시 서버에게 요청하는 것.
- Cache-Control 전략
	![](attach/스크린샷%202021-04-12%20오후%2012.43.14.png)
## 3.  [Source code for Minimize critical request depth audit](https://github.com/GoogleChrome/lighthouse/blob/master/lighthouse-core/audits/critical-request-chains.js) 를 읽고 어떤 리소스들이 critical requests에 포함되는지 확인해보고, 왜 그 리소스들이 critical requests로 구분되었는지 생각해봅시다.

[Critical request chains](https://developers.google.com/web/fundamentals/performance/critical-rendering-path)은 페이지 렌더링에 중요한 일련의 종속 네트워크 요청이다. 체인 길이가 길거나 다운로드 크기가 클수록 성능에 미치는 영향력은 커진다.

즉 리소스의 길이, 크기, 순서등이 영향을 미치는 것으로 볼수 있다.

만약 JS, CSS 등은 렌더링 차단 리소소들이다. 만약 특정 JS가 다시 다른 JS를 호출하거나 CSS등을 호출하다면 그 동안 렌더링은 차단될 것이다. 렌더링이 차단되지 않으려면 이러한 리소스들을 어떻게 호출할것인지 고민해야 한다. 결국 이는 빠른 렌더링을 하기 위해서인데 길이가 긴것들이나 파일이 큰것들은 이 리소스를 다운로드 받을때 절대 시간이 증가한다. 그렇기 때문에 이러한 것들을 줄여야 하는 것이고, 렌더링할때 필요 없는 리소스를 동기적으로 호출에서 렌더링을 막는것도 불필요한 요소이다. 렌더링에 필요없는 것들은 비동기로 호출 함으로서 렌더링에 불필요한 요소를 최대한 배제하는 것이 목적이라 볼수 있다.